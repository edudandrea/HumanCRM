<body>
  <div class="container mt-5">
    <h2 class="text-center" style="font-family: 'Raleway', serif;">
      <i class="fa-duotone fa-solid fa-users"></i> Lista de Usuários
    </h2>


    <div class="search-container">
      <div class="input-field search-box">
        <i class="fas fa-search"></i>
        <input type="text" [(ngModel)]="searchTerm" (ngModelChange)="searchUsers()" placeholder="Pesquisar usuários..." />
      </div>
    </div>
    <p></p>

    <!-- Lista de Usuários -->
    <div class="d-flex justify-content-between mb-3">
      <p class="lead" style="font-family: 'Raleway', serif;">Usuários cadastrados:</p>
    </div>

    <!-- Cards de Usuários -->
    <div class="row">
      @for (users of filteredUsers; track users) {
        <div class="col-md-4 mb-4">
          <div class="card custom-card shadow-lg border-0 rounded-3 overflow-hidden">
            <div class="card-body p-4">
              <h5 class="card-title text-center text-uppercase font-weight-bold" style="color: #0a958e;"><i class="fa-solid fa-user-tie"></i> {{ users.login }}</h5>
              <p class="card-text text-muted text-center" style="font-family: 'Raleway', serif;"><i class="fa-solid fa-address-card"></i>: {{ users.userName || 'Sem email' }}</p>
              <ul class="list-unstyled mt-3">
                <p class="card-text text-muted text-center"><li><i class="fa-solid fa-briefcase"></i>: {{ users.function == 'admin' ? 'Administrador': users.function == 'user' ? 'Usuário':'—' }}</li></p>
              </ul>
              <div class="d-flex justify-content-around mt-3">
                <button class="btn-outline-edit btn-sm rounded-pill px-4" (click)="openModalEdit(templateEdit, users.userId)">
                  <i class="fa-solid fa-file-pen"></i> Editar
                </button>
                <button class="btn-outline-del btn-sm rounded-pill px-4" (click)="deleteUser(users.userId, users.login)">
                  <i class="fa-solid fa-trash"></i> Excluir
                </button>
              </div>
            </div>
          </div>
        </div>
      }
    </div>

    <!-- Botão Novo Usuario -->
    <div class="btn-container">
      <button class="btn btn-primary rounded-pill mt-4" (click)="openModal(template)">
        <i class="bi bi-plus-circle "></i> Novo Usuário
      </button>
    </div>


    <ng-template #noClients>
      <p>Não há usuários cadastrados.</p>
    </ng-template>

    <!-- Modal de Cadastro -->
    <ng-template #template>
      <div class="modal-header">
        <h5 class="modal-title center">Novo Usuário</h5>
        <button type="button" class="btn-close" (click)="bsModalRef?.hide()"></button>
      </div>
      <div class="modal-body">
        <!-- Formulário para adicionar Usuário -->
        <div class="card shadow-lg p-4 rounded">
          <form>
            <div class="mb-3">
              <label for="login" class="form-label fw-bold">Login do Usuário</label>
              <div class="input-field search-box">
                <i class="fa-solid fa-user"></i>
                <input type="text" id="login" placeholder="Digite o login" [(ngModel)]="login" name="login" required>
              </div>
            </div>

            <div class="mb-3">
              <label for="userName" class="form-label fw-bold">Nome do Usuário</label>
              <div class="input-field search-box">
                <i class="fa-solid fa-id-card"></i>
                <input type="userName" id="userName" placeholder="Digite o Nome do Usuário" [(ngModel)]="userName" name="userName" required>
              </div>
            </div>

            <div class="row">
              <div class="col-12">
                <label class="form-label fw-bold" style="font-family: 'Raleway', serif;">Senha e Função</label>

                <div class="d-flex gap-3">
                  <!-- Campo de senha -->
                  <div style="width: 50%;">
                    <div class="input-field search-box full-width">
                      <i class="fa-solid fa-key"></i>
                      <input
                        [type]="showPassword ? 'text' : 'password'"
                        id="password"
                        placeholder="Digite a Senha"
                        [(ngModel)]="password"
                        name="password"
                        required
                        >
                      <button
                        type="button"
                        class="btn btn-outline-secondary"
                        (click)="togglePasswordVisibility()"
                        >
                        <i [ngClass]="showPassword ? 'bi bi-eye-slash' : 'bi bi-eye'"></i>
                      </button>
                    </div>
                  </div>

                  <!-- Dropdown de função -->
                  <div style="width: 50%;">
                    <div class="input-field search-box full-width">
                      <i class="fa-solid fa-user-tag"></i>
                      <select
                        class="form-select border-0 bg-transparent"
                        id="function"
                        [(ngModel)]="selectedFunction"
                        name="function"
                        required
                        >
                        <option value="">Selecione a Função</option>
                        <option value="admin">Administrador</option>
                        <option value="user">Usuário</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <button type="submit" class="btn btn-primary rounded-pill w-100 mt-3 shadow-sm" (click)="addUser()">Cadastrar</button>
          </form>
        </div>
      </div>
    </ng-template>

    <ng-template #templateEdit>
      <div class="modal-header">
        <h5 class="modal-title">Edite as informações</h5>
        <button type="button" class="btn-close" (click)="bsModalRef?.hide()"></button>
      </div>
      <div class="modal-body">
        <!-- Formulário para adicionar usuário -->
        <div class="card shadow-lg p-4 rounded">
          <h4 class="text-center mb-4">Editar Usuário</h4>
          <form>
            <div class="mb-3">
              <label for="userName" class="form-label fw-bold">Nome do Usuário</label>
              <div class="input-field search-box">
                <i class="fa-solid fa-id-card"></i>
                <input type="text" class="form-control rounded" id="userName" placeholder="Digite o nome" [(ngModel)]="editedUser.userName" name="userName" required>
              </div>
            </div>

            <div class="row">
              <div class="col-12">
                <label class="form-label fw-bold">Senha e Função</label>
                <div class="d-flex gap-3">
                  <!-- Campo de senha -->
                  <div style="width: 50%;">
                    <div class="input-field search-box full-width">
                      <i class="fa-solid fa-key"></i>
                      <input
                        [type]="showPassword ? 'text' : 'password'"
                        id="password"
                        placeholder="Digite a Senha"
                        [(ngModel)]="editedUser.password"
                        name="password"
                        required
                        >
                      <button
                        type="button"
                        class="btn btn-outline-secondary"
                        (click)="togglePasswordVisibility()"
                        >
                        <i [ngClass]="showPassword ? 'bi bi-eye-slash' : 'bi bi-eye'"></i>
                      </button>
                    </div>
                  </div>

                  <!-- Dropdown de função -->
                  <div style="width: 50%;">
                    <div class="input-field search-box full-width">
                      <i class="fa-solid fa-user-tag"></i>
                      <select
                        class="form-select border-0 bg-transparent"
                        id="function"
                        [(ngModel)]="editedUser.selectedFunction"
                        name="function"
                        required
                        >
                        <option value="">Selecione a Função</option>
                        <option value="admin">Administrador</option>
                        <option value="user">Usuário</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <button type="submit" class="btn btn-primary rounded-pill w-100 mt-3 shadow-sm" (click)="editUser()">Confirmar</button>
          </form>
        </div>
      </div>
    </ng-template>